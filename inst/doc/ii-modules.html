<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Alex M. Chubaty" />


<title>02 Building SpaDES modules</title>

<script src="ii-modules_files/header-attrs-2.22/header-attrs.js"></script>
<script src="ii-modules_files/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="ii-modules_files/d3-3.3.8/d3.min.js"></script>
<script src="ii-modules_files/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="ii-modules_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="ii-modules_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="ii-modules_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="ii-modules_files/chromatography-0.1/chromatography.js"></script>
<script src="ii-modules_files/DiagrammeR-binding-1.0.10/DiagrammeR.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="/home/emcintir/R/x86_64-pc-linux-gnu-library/4.3/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">02 Building <code>SpaDES</code>
modules</h1>
<h4 class="author">Alex M. Chubaty</h4>
<h4 class="date">July 05 2023</h4>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction"><span
class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#module-overview" id="toc-module-overview"><span
class="toc-section-number">1.1</span> Module overview</a>
<ul>
<li><a href="#simulation-event-list"
id="toc-simulation-event-list"><span
class="toc-section-number">1.1.1</span> Simulation event list</a></li>
<li><a href="#module-events" id="toc-module-events"><span
class="toc-section-number">1.1.2</span> Module events</a></li>
<li><a href="#module-event-dependencies"
id="toc-module-event-dependencies"><span
class="toc-section-number">1.1.3</span> Module event
dependencies</a></li>
</ul></li>
</ul></li>
<li><a href="#module-structure" id="toc-module-structure"><span
class="toc-section-number">2</span> Module structure</a>
<ul>
<li><a href="#module-directory-structure-modulename"
id="toc-module-directory-structure-modulename"><span
class="toc-section-number">2.1</span> Module directory structure
(<code>moduleName/</code>)</a></li>
<li><a href="#module-code-file-modulename.r"
id="toc-module-code-file-modulename.r"><span
class="toc-section-number">2.2</span> Module code file
(<code>moduleName.R</code>)</a>
<ul>
<li><a href="#metadata" id="toc-metadata"><span
class="toc-section-number">2.2.1</span> Metadata</a></li>
<li><a href="#event-types" id="toc-event-types"><span
class="toc-section-number">2.2.2</span> Event types</a></li>
<li><a href="#event-functions" id="toc-event-functions"><span
class="toc-section-number">2.2.3</span> Event functions</a></li>
<li><a href="#event-diagram" id="toc-event-diagram"><span
class="toc-section-number">2.2.4</span> Event diagram</a></li>
</ul></li>
<li><a href="#module-documentation-modulename.rmd"
id="toc-module-documentation-modulename.rmd"><span
class="toc-section-number">2.3</span> Module documentation
(<code>moduleName.Rmd</code>)</a></li>
<li><a href="#citation-license-and-readme-files"
id="toc-citation-license-and-readme-files"><span
class="toc-section-number">2.4</span> Citation, LICENSE, and README
files</a></li>
<li><a href="#data" id="toc-data"><span
class="toc-section-number">2.5</span> Data</a></li>
<li><a href="#versioned-zip-archives-modulename_x.y.z.zip"
id="toc-versioned-zip-archives-modulename_x.y.z.zip"><span
class="toc-section-number">2.6</span> Versioned zip archives
(<code>moduleName_x.y.z.zip</code>)</a></li>
</ul></li>
<li><a href="#passing-data-between-modules"
id="toc-passing-data-between-modules"><span
class="toc-section-number">3</span> Passing data between modules</a>
<ul>
<li><a href="#data-types" id="toc-data-types"><span
class="toc-section-number">3.1</span> Data types</a></li>
<li><a href="#global-objects-and-the-simulation-environment"
id="toc-global-objects-and-the-simulation-environment"><span
class="toc-section-number">3.2</span> Global objects and the simulation
environment</a></li>
<li><a href="#module-object-dependencies"
id="toc-module-object-dependencies"><span
class="toc-section-number">3.3</span> Module object
dependencies</a></li>
</ul></li>
<li><a href="#core-modules" id="toc-core-modules"><span
class="toc-section-number">4</span> Core modules</a>
<ul>
<li><a href="#checkpoint-module" id="toc-checkpoint-module"><span
class="toc-section-number">4.1</span> <code>.checkpoint</code>
module</a></li>
<li><a href="#progress-module" id="toc-progress-module"><span
class="toc-section-number">4.2</span> <code>.progress</code>
module</a></li>
<li><a href="#load-and-.save-modules"
id="toc-load-and-.save-modules"><span
class="toc-section-number">4.3</span> <code>.load</code> and
<code>.save</code> modules</a>
<ul>
<li><a href="#inputs-argument-to-siminit"
id="toc-inputs-argument-to-siminit"><span
class="toc-section-number">4.3.1</span> <code>inputs</code> argument to
<code>simInit</code></a></li>
<li><a href="#outputs-argument-to-siminit"
id="toc-outputs-argument-to-siminit"><span
class="toc-section-number">4.3.2</span> <code>outputs</code> argument to
<code>simInit</code></a></li>
</ul></li>
<li><a href="#plotting" id="toc-plotting"><span
class="toc-section-number">4.4</span> Plotting</a></li>
</ul></li>
<li><a href="#using-existing-spades-modules"
id="toc-using-existing-spades-modules"><span
class="toc-section-number">5</span> Using existing <code>SpaDES</code>
modules</a>
<ul>
<li><a href="#included-sample-modules"
id="toc-included-sample-modules"><span
class="toc-section-number">5.1</span> Included sample modules</a></li>
<li><a href="#spades-module-repository"
id="toc-spades-module-repository"><span
class="toc-section-number">5.2</span> <code>SpaDES</code> module
repository</a></li>
</ul></li>
<li><a href="#creating-new-modules" id="toc-creating-new-modules"><span
class="toc-section-number">6</span> Creating new modules</a>
<ul>
<li><a href="#module-design-considerations"
id="toc-module-design-considerations"><span
class="toc-section-number">6.1</span> Module design
considerations</a></li>
<li><a href="#using-the-module-template"
id="toc-using-the-module-template"><span
class="toc-section-number">6.2</span> Using the module template</a></li>
<li><a href="#module-groups" id="toc-module-groups"><span
class="toc-section-number">6.3</span> Module groups</a></li>
<li><a href="#debugging" id="toc-debugging"><span
class="toc-section-number">6.4</span> Debugging</a></li>
<li><a href="#contributing-modules" id="toc-contributing-modules"><span
class="toc-section-number">6.5</span> Contributing modules</a>
<ul>
<li><a href="#minimum-requirements" id="toc-minimum-requirements"><span
class="toc-section-number">6.5.1</span> Minimum requirements</a></li>
<li><a href="#module-submission" id="toc-module-submission"><span
class="toc-section-number">6.5.2</span> Module submission</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<style type="text/css">
/*********************************************************
  17 Feb 2020: workaround DiagrammeR css bug 
  https://github.com/rich-iannone/DiagrammeR/issues/375
*********************************************************/
.section {
  opacity: 1;
}
</style>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<div id="module-overview" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Module overview</h2>
<p>Recall that <code>SpaDES</code> simulations are event-driven, meaning
that different actions are performed on data objects based on the order
of scheduled events. The central design of <code>SpaDES</code> promotes
modularity, such that collections of related simulation actions can be
grouped together as ‘modules’ and easily reused among multiple
simulations. Strict modularity requires that modules can act
independently, without needing to know about other modules. Thus each
<code>SpaDES</code> module must explicitly state its input dependencies
(data, package, and parameterization requirements), data outputs, as
well as provide other useful metadata and documentation for the user.
Upon initialization of a simulation via <code>simInit</code>, the
dependencies of every module used are examined and evaluated. If
dependency incompatibilities exists, the initialization fails and the
user is notified. Also during this initialization, module code is
<code>source</code>-ed into the simulation environment, making all
module objects and functions available during the simulation.</p>
<p>Each <code>SpaDES</code> module describes the processes or activities
that drive simulation state changes via changes to objects stored in the
simulation environment. Each activity consists of a collection of events
which are scheduled depending on the rules of the simulation. Each event
may evaluate or modify a simulation data object (<em>e.g.</em>, update
the values on a raster map), or perform other operations such as saving
and loading data objects, plotting, or scheduling other events.</p>
<div id="simulation-event-list" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Simulation event
list</h3>
<p>The event queue is stored in a slot in a <code>simList</code>
simulation object. Each event is represented by a
<code>data.table</code> row consisting of the time the event is to occur
(<code>eventTime</code>), the name of the module from which the event is
taken (<code>moduleName</code>), and a character string for the
programmer-defined event type (<code>eventType</code>). This list is
kept sorted by <code>eventTime</code>, and events are processed in
sequence beginning at the top of the list. Completed events are removed
from the queue.</p>
</div>
<div id="module-events" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Module events</h3>
<p>When a call to the event list is made, the event is processed by the
module specified by <code>moduleName</code>. The module code then
determines the event type and executes the code for that event. For each
event type within a module: 1) the instructions for what happens for
this event get executed; and 2) there is an optional call to
<code>scheduleEvent</code>, which schedules a future event. A module can
schedule other event types from within the same module, and should not
call other modules because this introduces module dependencies, which
breaks the drop-in/replace modularity of your simulation model.</p>
</div>
<div id="module-event-dependencies" class="section level3"
number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Module event
dependencies</h3>
<p>Each module schedules its own events (<em>e.g.</em>, a ‘fire’ module
may schedule ‘burn’ events) and only uses its own data objects (or
shared simulation objects). Modules that behave in this way are
independent of one another, which is the preferred way to design and
implement modules. Maintaining strict modularity allows the removal,
addition, and replacement of modules without having to rewrite your
code.</p>
<p>Module event dependencies complicate the construction of simulation
models, and hinder the ability to develop and deploy models with
modularity. If two modules are actually dependent on each others’
events, then you should consider whether they really are separate
modules or should be merged into a single module.</p>
</div>
</div>
</div>
<div id="module-structure" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Module structure</h1>
<div id="module-directory-structure-modulename" class="section level2"
number="2.1">
<h2><span class="header-section-number">2.1</span> Module directory
structure (<code>moduleName/</code>)</h2>
<p>A module consists of a collection of files and folders that …</p>
<pre><code>/moduleRepository
  |_ moduleName/
      |_ R/                     # contains additional module R scripts
      |_ data/                  # directory for all included data
          |_ CHECKSUMS.txt      # contains checksums for data files
      |_ tests/                 # contains unit tests for module code
      |_ citation.bib           # bibtex citation for the module
      |_ LICENSE.md             # describes module&#39;s legal usage
      |_ NEWS.md                # log of changes made to module code
      |_ README.md              # symlink to rendered documentation file (moduleName.md)
      |_ moduleName.R           # module code file (incl. metadata)
      |_ moduleName.Rmd         # documentation, usage info, etc.
      |_ moduleName_x.y.z.zip   # zip archive of previous versions</code></pre>
</div>
<div id="module-code-file-modulename.r" class="section level2"
number="2.2">
<h2><span class="header-section-number">2.2</span> Module code file
(<code>moduleName.R</code>)</h2>
<p>A <code>SpaDES</code> module consists of a single <code>.R</code>
source file, whose name matches the name of the module. This file
consists of three parts containing the code for:</p>
<ol style="list-style-type: decimal">
<li>the metadata describing the module and its data dependencies;</li>
<li>defining the event types described in the module;</li>
<li>functions describing what happens during the processing of each
event type.</li>
</ol>
<div id="metadata" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Metadata</h3>
<p>In order to interact correctly with one another in a simulation,
<code>SpaDES</code> modules are designed to be aware of their own
dependencies and to share this information with the simulation (and to
the user). During simulation initialization, the <code>.R</code> file
corresponding to each module used is parsed and the modules’ metadata
stored in the <code>simList</code> object inside the <code>envir</code>.
As part of this initialization step, the dependencies of each module are
extracted from the metadata and are checked against the other modules
used in the simulation to ensure that all dependencies can be
resolved.</p>
<div id="defining-module-metadata-definemodule" class="section level4"
number="2.2.1.1">
<h4><span class="header-section-number">2.2.1.1</span> Defining module
metadata: <code>defineModule()</code></h4>
<p>Every module requires complete metadata, structured as a named list,
and passed as an argument to the <code>defineModule</code> function.</p>
<table>
<colgroup>
<col width="30%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Element name</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>name</code></strong></td>
<td>Name of the module as a character string.</td>
</tr>
<tr class="even">
<td><strong><code>description</code></strong></td>
<td>Description of the module as a character string.</td>
</tr>
<tr class="odd">
<td><strong><code>keywords</code></strong></td>
<td>Character vector containing a module’s keywords.</td>
</tr>
<tr class="even">
<td><strong><code>childModules</code></strong></td>
<td>Character vector containing the names of the child modules that are
part of this module.</td>
</tr>
<tr class="odd">
<td><strong><code>authors</code></strong></td>
<td>The author(s) of the module as a <code>person</code> object.</td>
</tr>
<tr class="even">
<td><strong><code>version</code></strong></td>
<td>The module version as a character, numeric, or
<code>numeric_version</code>. <a href="https://semver.org/">Semantic
versioning</a> is assumed.</td>
</tr>
<tr class="odd">
<td><strong><code>spatialExtent</code></strong></td>
<td>Specifies the module’s spatial extent as an <code>Extent</code>
object.</td>
</tr>
<tr class="even">
<td><strong><code>timeframe</code></strong></td>
<td>Specifies the valid timeframe for which the module was designed to
simulate.</td>
</tr>
<tr class="odd">
<td> </td>
<td>Must be a <code>POSIXt</code> object of length <code>2</code>,
specifying the start and end times.</td>
</tr>
<tr class="even">
<td> </td>
<td>(NOT YET FULLY IMPLEMENTED.)</td>
</tr>
<tr class="odd">
<td><strong><code>timeunit</code></strong></td>
<td>Describes the unit of time corresponding to <code>1.0</code>
simulation time units.</td>
</tr>
<tr class="even">
<td><strong><code>citation</code></strong></td>
<td>A list of citations for the module, as a character strings.</td>
</tr>
<tr class="odd">
<td> </td>
<td>Alternatively, the name of a or similar file.</td>
</tr>
<tr class="even">
<td><strong><code>documentation</code></strong></td>
<td>List of filenames referring to module documentation sources.</td>
</tr>
<tr class="odd">
<td><strong><code>reqdPkgs</code></strong></td>
<td>Character vector of R package names to be loaded.</td>
</tr>
<tr class="even">
<td><strong><code>parameters</code></strong></td>
<td>A <code>data.frame</code> constructed using <code>rbind</code> with
<code>defineParameter</code>, specifying module</td>
</tr>
<tr class="odd">
<td> </td>
<td>parameters, with columns <code>paramName</code>,
<code>paramClass</code>, <code>default</code>, <code>min</code>,
<code>max</code>, and <code>paramDesc</code>.</td>
</tr>
<tr class="even">
<td> </td>
<td>Default values may be overridden by the user by passing a list of
parameters to <code>simInit</code>.</td>
</tr>
<tr class="odd">
<td><strong><code>inputObjects</code></strong></td>
<td>A <code>data.frame</code> constructed using <code>bindrows</code>
with <code>expectsInput</code>, specifying</td>
</tr>
<tr class="even">
<td> </td>
<td>the object dependencies of the module, with columns
<code>objectName</code>, <code>objectClass</code>, <code>desc</code>,
<code>sourceURL</code> and other specifications.</td>
</tr>
<tr class="odd">
<td> </td>
<td>For objects that are used within the module as both an input and an
output,</td>
</tr>
<tr class="even">
<td> </td>
<td>add an input object by using <code>expectsInput</code>.</td>
</tr>
<tr class="odd">
<td><strong><code>outputObjects</code></strong></td>
<td>A <code>data.frame</code> constructed using <code>bindrows</code>
with <code>createsOutput</code>, specifying</td>
</tr>
<tr class="even">
<td> </td>
<td>the objects output by the module, with columns
<code>objectName</code>, <code>objectClass</code>, <code>desc</code> and
other specifications.</td>
</tr>
<tr class="odd">
<td> </td>
<td>Add an output object by using <code>createsOutput</code>.</td>
</tr>
</tbody>
</table>
<pre><code>## sample module metadata for the default `caribouMovement` module
defineModule(sim, list(
  name = &quot;caribouMovement&quot;,
  description = &quot;Simulate caribou movement via correlated random walk.&quot;,
  keywords = c(&quot;caribou&quot;, &quot;individual based movement model&quot;, &quot;correlated random walk&quot;),
  childModules = character(),
  authors = c(person(c(&quot;Eliot&quot;, &quot;J&quot;, &quot;B&quot;), &quot;McIntire&quot;, email = &quot;eliot.mcintire@nrcan-rncan.gc.ca&quot;,
                     role = c(&quot;aut&quot;, &quot;cre&quot;))),
  version = list(caribouMovement = &quot;1.6.1&quot;),
  spatialExtent = terra::ext(rep(0, 4)),
  timeframe = as.POSIXlt(c(NA, NA)),
  timeunit = &quot;month&quot;,
  citation = list(),
  documentation = list(),
  reqdPkgs = list(&quot;grid&quot;, &quot;terra&quot;, &quot;sf&quot;, &quot;stats&quot;, &quot;SpaDES.tools (&gt;= 2.0.0)&quot;),
  parameters = rbind(
    defineParameter(&quot;stackName&quot;, &quot;character&quot;, &quot;landscape&quot;, NA, NA, &quot;name of the RasterStack&quot;),
    defineParameter(&quot;moveInitialTime&quot;, &quot;numeric&quot;, start(sim) + 1, start(sim) + 1, end(sim),
                    &quot;time to schedule first movement event&quot;),
    defineParameter(&quot;moveInterval&quot;, &quot;numeric&quot;, 1.0, 1, 1,
                    &quot;time interval between movoment events&quot;),
    defineParameter(&quot;N&quot;, &quot;numeric&quot;, 100L, 10L, 1000L, &quot;initial number of caribou&quot;),
    defineParameter(&quot;torus&quot;, &quot;logical&quot;, FALSE, FALSE, TRUE,
                    &quot;should the map wrap around like a torus?&quot;),
    defineParameter(&quot;.plots&quot;, &quot;character&quot;, &quot;screen&quot;, NA, NA,
                    &quot;A modular mechanism to create plots, using png, screen device or other. See ?Plots.&quot;),
    defineParameter(&quot;.plotInitialTime&quot;, &quot;numeric&quot;, start(sim), -Inf, Inf,
                    &quot;time to schedule first plot event&quot;),
    defineParameter(&quot;.plotInterval&quot;, &quot;numeric&quot;, 1, -Inf, Inf,
                    &quot;time interval between plot events&quot;),
    defineParameter(&quot;.saveInitialTime&quot;, &quot;numeric&quot;, NA_real_, -Inf, Inf,
                    &quot;time to schedule first save event&quot;),
    defineParameter(&quot;.saveInterval&quot;, &quot;numeric&quot;, NA_real_, -Inf, Inf,
                    &quot;time interval between save events&quot;),
    defineParameter(&quot;.seed&quot;, &quot;list&quot;, list(), NA, NA,
                    paste(&quot;Named list of seeds to use for each event (names).&quot;,
                          &quot;E.g., `list(&#39;init&#39; = 123)` will `set.seed(123)`&quot;,</code></pre>
</div>
<div id="defining-module-parameters-defineparameter"
class="section level4" number="2.2.1.2">
<h4><span class="header-section-number">2.2.1.2</span> Defining module
parameters: <code>defineParameter()</code></h4>
<p>Parameters here differ from input data objects in that the former are
intended to be variable across simulation runs, whereas the latter
remain constant. Parameters are often module-specific, where they are
only used within the module they are defined, although it may be useful
to globally define some parameters that are intended to be used by
multiple modules. Module-specific parameters are specified using
<code>defineParameter</code> (with <code>rbind</code>) within
<code>defineModule</code> to build a <code>data.frame</code> of input
parameters. Global parameters are defined at the simulation level as
part of the <code>simInit</code> call.</p>
<p>The parameter list in the <code>simList</code> object (accessed via
<code>P</code> or <code>params</code>) may be used to pass named
parameter values to modules. The general structure of this parameter
list is a nested list of lists: the top level list contains all module
names, each of those is a list of module parameters: This would normally
be accessed using the <code>P</code>: <code>P(sim)$paramName</code> if
inside a module, or <code>P(mySim)$moduleName$moduleParameter</code> if
not inside a module. This nested list structure allows passing as many
parameters as needed for your simulation. We suggest passing a list of
all the parameters needed for a single module together, but this is not
strictly necessary.</p>
<p>A module’s metadata defines default values for module-specific
parameters, and these defaults will be used unless overridden by the
user. Default parameter values can overridden by passing values in the
parameter list to <code>simInit</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(SpaDES.core)</span></code></pre></div>
<pre><code>## Loading required package: quickPlot</code></pre>
<pre><code>## Loading required package: reproducible</code></pre>
<pre><code>## 
## Attaching package: &#39;SpaDES.core&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     end, start</code></pre>
<pre><code>## The following object is masked from &#39;package:utils&#39;:
## 
##     citation</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>outputDir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;simOutputs&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fl">0.0</span>, <span class="at">end =</span> <span class="fl">5.0</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>, <span class="at">burnStats =</span> <span class="st">&quot;nPixelsBurned&quot;</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.progress =</span> <span class="fu">list</span>(<span class="cn">NA</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomLandscapes =</span> <span class="fu">list</span>(<span class="at">nx =</span> 100L, <span class="at">ny =</span> 100L, <span class="at">inRAM =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fireSpread =</span> <span class="fu">list</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">nFires =</span> 10L, <span class="at">spreadprob =</span> <span class="fl">0.225</span>, <span class="at">its =</span> <span class="fl">1e6</span>, <span class="at">persistprob =</span> <span class="dv">0</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">returnInterval =</span> <span class="dv">10</span>, <span class="at">startTime =</span> <span class="dv">0</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.plotInitialTime =</span> <span class="dv">0</span>, <span class="at">.plotInterval =</span> <span class="dv">10</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">caribouMovement =</span> <span class="fu">list</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> 100L, <span class="at">moveInterval =</span> <span class="dv">1</span>, <span class="at">torus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.plotInitialTime =</span> <span class="dv">1</span>, <span class="at">.plotInterval =</span> <span class="dv">1</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;randomLandscapes&quot;</span>, <span class="st">&quot;fireSpread&quot;</span>, <span class="st">&quot;caribouMovement&quot;</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>objects <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">outputPath =</span> outputDir)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> times, <span class="at">params =</span> parameters, <span class="at">modules =</span> modules,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">objects =</span> objects, <span class="at">paths =</span> paths)</span></code></pre></div>
<pre><code>## Setting:
##   options(
##     spades.outputPath = &#39;/tmp/RtmpG9NhfZ/simOutputs&#39;
##     spades.modulePath = &#39;/tmp/RtmpG9NhfZ/sampleModules&#39;
##   )</code></pre>
<pre><code>## Paths set to:
##   options(
##     rasterTmpDir = &#39;/tmp/RtmpG9NhfZ/SpaDES/scratch/raster&#39;
##     reproducible.cachePath = &#39;/tmp/RtmpG9NhfZ/reproducible/cache&#39;
##     spades.inputPath = &#39;/tmp/RtmpG9NhfZ/SpaDES/inputs&#39;
##     spades.outputPath = &#39;/tmp/RtmpG9NhfZ/simOutputs&#39;
##     spades.modulePath = &#39;/tmp/RtmpG9NhfZ/sampleModules&#39;
##     spades.scratchPath = &#39;/tmp/RtmpG9NhfZ/SpaDES/scratch&#39;
##   )
##   terra::terraOptions(tempdir = &#39;/tmp/RtmpG9NhfZ/SpaDES/scratch/terra&#39;</code></pre>
<pre><code>## Loading required package: RColorBrewer</code></pre>
<pre><code>## Loading required package: terra</code></pre>
<pre><code>## terra 1.7.39</code></pre>
<pre><code>## 
## Attaching package: &#39;terra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:SpaDES.core&#39;:
## 
##     time&lt;-</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     area</code></pre>
<pre><code>## The following object is masked from &#39;package:knitr&#39;:
## 
##     spin</code></pre>
<pre><code>## The following object is masked from &#39;package:SpaDES.tools&#39;:
## 
##     wrap</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## 
## Attaching package: &#39;grid&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:terra&#39;:
## 
##     depth</code></pre>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.11.1, GDAL 3.6.2, PROJ 9.1.1; sf_use_s2() is TRUE</code></pre>
<pre><code>## Using setDTthreads(1). To change: &#39;options(spades.DTthreads = X)&#39;.</code></pre>
<pre><code>## defineParameter: &#39;.useCache&#39; is not of specified type &#39;logical&#39;.</code></pre>
<pre><code>## The following .globals were used:</code></pre>
<pre><code>##              module    global</code></pre>
<pre><code>## 1:  caribouMovement stackName</code></pre>
<pre><code>## 2:       fireSpread stackName</code></pre>
<pre><code>## 3: randomLandscapes stackName</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Access parameters</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">P</span>(mySim)                    <span class="co"># shows all parameters</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">P</span>(mySim, <span class="at">module =</span> <span class="st">&quot;caribouMovement&quot;</span>) <span class="co"># only parameters in caribouMovement module</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">P</span>(mySim)<span class="sc">$</span>caribouMovement    <span class="co"># same</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">P</span>(mySim)<span class="sc">$</span>caribouMovement<span class="sc">$</span>N  <span class="co"># Only one parameter</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="do">## If used within the module source code, then module name can be omitted:</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="do">## This will return NULL here, but will return the actual value if used</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="do">## in a module</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">P</span>(mySim)<span class="sc">$</span>N  <span class="co"># Only one parameter if used within a module</span></span></code></pre></div>
</div>
</div>
<div id="event-types" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Event types</h3>
<p>Each module may contain an arbitrary number of event types. Each of
these event types are defined within the <code>doEvent.moduleName</code>
call, and are wrapped in a simple <code>if</code>/<code>else</code>
stanza that matches the called event type (NOTE: when several event
types are defined, <code>switch</code>/<code>case</code> can faster than
<code>if</code>/<code>else</code>). To keep the
<code>doEvent.moduleName</code> code block as clear and readable as
possible, keep the definitions of each event type minimal, using
functions (defined outside of the block) for the details of what is
happening for each event.</p>
<pre><code>## sample event type definitions for the default `caribouMovement` module
  )
))

## event types
doEvent.caribouMovement &lt;- function(sim, eventTime, eventType, debug = FALSE) {
  switch(
    eventType,
    init = {
      ### check for more detailed object dependencies:
      ### (use `checkObject` or similar)
      checkObject(sim, name = Par$stackName, layer = &quot;habitatQuality&quot;)

      # do stuff for this event
      sim &lt;- Init(sim)

      # schedule the next event
      sim &lt;- scheduleEvent(sim, Par$moveInitialTime,
                           &quot;caribouMovement&quot;, &quot;move&quot;)
      sim &lt;- scheduleEvent(sim, Par$.plotInitialTime,
                           &quot;caribouMovement&quot;, &quot;plot.init&quot;, .last())
      sim &lt;- scheduleEvent(sim, Par$.saveInitialTime,
                           &quot;caribouMovement&quot;, &quot;save&quot;, .last() + 1)
    },
    move = {
      # do stuff for this event
      sim &lt;- Move(sim)

      # schedule the next event
      sim &lt;- scheduleEvent(sim, time(sim) + Par$moveInterval, &quot;caribouMovement&quot;, &quot;move&quot;)
    },
    plot.init = {
      # If this is scheduled because .plotInitialTime is not NA, it may not do anything
      #   if Par$.plots is not &quot;screen&quot;, &quot;png&quot; or another type.
      Plots(sim$caribou, addTo = paste(&quot;sim&quot;, Par$stackName, &quot;habitatQuality&quot;, sep = &quot;$&quot;),
           new = FALSE, size = 0.2, pch = 19, gp = gpar(cex = 0.6), usePlot = TRUE)

      # schedule the next event
      sim &lt;- scheduleEvent(sim, time(sim) + Par$.plotInterval, &quot;caribouMovement&quot;, &quot;plot&quot;, .last())
    },
    plot = {
      Plots(sim$caribou, new = FALSE, pch = 19, size = 0.1, gp = gpar(cex = 0.6),
            usePlot = TRUE)

      # schedule the next event
      sim &lt;- scheduleEvent(sim, time(sim) + Par$.plotInterval, &quot;caribouMovement&quot;, &quot;plot&quot;, .last())
    },
    save = {
      # do stuff for this event
      sim &lt;- saveFiles(sim)

      # schedule the next event
      sim &lt;- scheduleEvent(sim, time(sim) + Par$.saveInterval, &quot;caribouMovement&quot;, &quot;save&quot;, .last() + 1)

    },
    warning(paste(
      &quot;Undefined event type: \&#39;&quot;, events(sim)[1, &quot;eventType&quot;, with = FALSE],</code></pre>
</div>
<div id="event-functions" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Event
functions</h3>
<p>Event functions should be defined below the
<code>doEvent.moduleName</code> code block and follow the naming
convention <code>modulenameEventtype()</code>. Keep these function
definitions as short and clean as possible (you can further modularize
your functions by calling additional subroutines).</p>
<p>Functions should get and return objects in the simulation environment
(<code>envir</code>), rather than pass them as function arguments. This
mostly allows for function definitions to be simpler, <em>i.e.</em>,
they just take the one <code>sim</code> argument if parameters are
passed within the <code>simInit</code> call. Accessing objects in the
<code>envir</code> is similar to accessing items in a list,
<em>i.e.</em>, <code>sim[["object"]]</code> or <code>sim$object</code>
can be used, in addition to
<code>get("object", envir=envir(sim))</code>. Likewise, simulation
functions (<em>i.e.</em>, those defined in modules) are also accessed
using the <code>$</code> accessor (<em>e.g.</em>,
<code>sim$myFunction()</code>).</p>
<p>Note that every module requires an <code>"init"</code> event type,
which defines the initialization of the module; however, this
<code>init</code> event need not do a whole lot (<em>i.e.</em>, it can
be a stub). As such, the <code>Init()</code> function is required for
initialization. Modules may also include <code>"save"</code> and
<code>"plot"</code> events, though these are optional.</p>
<pre><code>## sample Init event function from the default `caribouMovement` module
}

## event functions
Init &lt;- function(sim) {
  yrange &lt;- c(ymin(sim[[Par$stackName]]),
              ymax(sim[[Par$stackName]]))
  xrange &lt;- c(xmin(sim[[Par$stackName]]),
              xmax(sim[[Par$stackName]]))

  # initialize caribou agents
  N &lt;- Par$N
  IDs &lt;- as.character(1:N)
  sex &lt;- sample(c(&quot;female&quot;, &quot;male&quot;), N, replace = TRUE)
  age &lt;- round(rnorm(N, mean = 8, sd = 3))
  x1 &lt;- rep(0, N)
  y1 &lt;- rep(0, N)
  starts &lt;- cbind(x = runif(N, xrange[1], xrange[2]),
                  y = runif(N, yrange[1], yrange[2]))

  # create the caribou agent object
  sim$caribou &lt;- vect(cbind(starts, data.frame(IDs, x1, y1, sex, age)), geom = c(&quot;x&quot;, &quot;y&quot;))

  return(invisible(sim))</code></pre>
</div>
<div id="event-diagram" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Event diagram</h3>
<p>To better understand how events are scheduled within a simulation, a
visual representation called an <code>eventDiagram</code> illustrates
the sequences of events within a simulation.</p>
<p>Simulation time is presented on the x-axis, starting at date
<code>startDate</code>. Each module appears in a colour-coded row,
within which each event for that module is displayed corresponding to
the sequence of events for that module. Note that only the start time of
the event is meaningful is these figures: the width of the bar
associated with a particular module’s event corresponds to the module’s
timestep unit, not the event’s “duration”.</p>
<pre><code>## png 
##   2</code></pre>
<div id="htmlwidget-27736d82c039bad0fd48" style="width:720px;height:650px;" class="DiagrammeR html-widget "></div>
<script type="application/json" data-for="htmlwidget-27736d82c039bad0fd48">{"x":{"diagram":"gantt\ndateFormat  YYYY-MM-DD\ntitle SpaDES event diagram\nsection  checkpoint \n init:done,checkpoint1,0-06-01,0-06-07\nsection  save \n init:done,save1,0-06-01,0-06-07\nsection  load \n init:done,load1,0-06-01,0-06-07\nsection  randomLandscapes \n init:done,randomLandscapes1,0-06-01,0-06-07\nplot:crit,randomLandscapes2,0-06-01,0-06-07\nsection  fireSpread \n init:done,fireSpread1,0-06-01,0-06-07\nburn:active,fireSpread2,0-06-01,0-06-07\nstats:active,fireSpread3,0-06-01,0-06-07\nplot.init:active,fireSpread4,0-06-01,0-06-07\nburn:active,fireSpread5,1-06-01,1-06-07\nstats:active,fireSpread6,1-06-01,1-06-07\nsection  caribouMovement \n init:done,caribouMovement1,0-06-01,0-06-07\nplot.init:active,caribouMovement2,0-07-01,0-07-07\nplot:crit,caribouMovement3,0-07-31,0-08-07\nplot:crit,caribouMovement4,0-08-31,0-09-06\nplot:crit,caribouMovement5,0-09-30,0-10-07\nplot:crit,caribouMovement6,0-10-31,0-11-06\nplot:crit,caribouMovement7,0-11-30,0-12-06\nplot:crit,caribouMovement8,0-12-31,1-01-06\nplot:crit,caribouMovement9,1-01-30,1-02-05\nplot:crit,caribouMovement10,1-03-01,1-03-08\nplot:crit,caribouMovement11,1-04-01,1-04-07\nplot:crit,caribouMovement12,1-05-01,1-05-08\nmove:active,caribouMovement13,1-06-01,1-06-07\nplot:crit,caribouMovement14,1-06-01,1-06-07\n"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="module-documentation-modulename.rmd" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Module documentation
(<code>moduleName.Rmd</code>)</h2>
<p>Module documentation should be written so that others can use your
module. As such, this documentation should include a high-level overview
of the module as well as low-level, detailed descriptions of its
usage.</p>
<p>We strongly recommend using R Markdown (<code>.Rmd</code>) for this
documentation, as it is easily human-readable while also being
machine-readable and easily converted to a wide variety of file formats
including <code>PDF</code>, <code>HTML</code>, and <code>DOCX</code>.
Another benefit of using a text-based file format is to facilitate
transparent document versioning and history using version control
systems like <code>git</code>. For help writing in R Markdown, see <a
href="https://rmarkdown.rstudio.com/"
class="uri">https://rmarkdown.rstudio.com/</a>.</p>
</div>
<div id="citation-license-and-readme-files" class="section level2"
number="2.4">
<h2><span class="header-section-number">2.4</span> Citation, LICENSE,
and README files</h2>
<ul>
<li><p><code>citation.bib</code> provides a <code>BibTeX</code>
formatted citation with which the module can be referenced. Most
citation management software can read and output <code>.bib</code>
format.</p></li>
<li><p><code>LICENSE.txt</code> describes how your module can be
redistributed and used by others. For help selecting a license, see <a
href="https://choosealicense.com">choosealicense.com</a>.</p></li>
<li><p><code>README.md</code> is used to briefly document module
metadata and version change information.</p></li>
</ul>
</div>
<div id="data" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Data</h2>
<p>All module data are located in the module’s <code>data/</code>
subdirectory. Also included in this folder is a
<code>CHECKSUMS.txt</code> file that contains the expected checksums for
each data file. Checksums can be verified (and optionally written) using
<code>checksums()</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. specify your module here</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>moduleName <span class="ot">&lt;-</span> <span class="st">&quot;my_module&quot;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. use a temp dir to ensure all modules get fresh copies of the data</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>tmpdir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;SpaDES_modules&quot;</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. download your module&#39;s data to the temp dir</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadData</span>(moduleName, tmpdir)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. initialize a dummy simulation to ensure any &#39;data prep&#39; steps in the .inputObjects section are run</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">simInit</span>(<span class="at">modules =</span> moduleName)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. recalculate your checksums and overwrite the file</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="fu">checksums</span>(moduleName, tmpdir, <span class="at">write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 6. copy the new checksums file to your working module directory (the one not in the temp dir)</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">file.path</span>(tmpdir, moduleName, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;CHECKSUMS.txt&#39;</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">to =</span> <span class="fu">file.path</span>(<span class="st">&#39;path/to/my/moduleDir&#39;</span>, moduleName, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;CHECKSUMS.txt&#39;</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Modules may require data that for various reasons cannot be
distributed with the module source code. In these cases, the module
developer should ensure that the module downloads and extracts the data
required. It is useful to not only check that the data files exist
locally but that their checksums match those expected (see
<code>checksums()</code>).</p>
</div>
<div id="versioned-zip-archives-modulename_x.y.z.zip"
class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Versioned zip
archives (<code>moduleName_x.y.z.zip</code>)</h2>
<p>Use <a href="https://semver.org/">semantic versioning</a>, such that
a version number <code>x.y.z</code> corresponds to:</p>
<ul>
<li><code>x</code> is the <strong>major</strong> version (incremented
when you make incompatible API changes)</li>
<li><code>y</code> is the <strong>minor</strong> version (incremented
when you add functionality in a backwards-compatible manner)</li>
<li><code>z</code> is the <strong>patch</strong> version (incremented
when you make backwards-compatible bug fixes)</li>
</ul>
</div>
</div>
<div id="passing-data-between-modules" class="section level1"
number="3">
<h1><span class="header-section-number">3</span> Passing data between
modules</h1>
<p>Modularity in <code>SpaDES</code> simulations is maintained by
ensuring modules interact indirectly with one another by reading in and
modifying objects in the simulation environment.</p>
<div id="data-types" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Data types</h2>
<p>As you build your modules for your simulation, you can use any of
<code>R</code>’s data types to store your objects and data. In
particular, matrices (including vectors) and lists work well for this
purpose because, as of <code>R</code> version <code>3.1.0</code>, they
are more efficient, reducing your model’s memory footprint and speeding
up your code’s execution. Other useful data types include
<code>Raster*</code> and <code>SpatialPoints*</code> objects (see
examples below).</p>
</div>
<div id="global-objects-and-the-simulation-environment"
class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Global objects and
the simulation environment</h2>
<p><code>R</code> passes copies of objects to functions (instead of
using pass-by-reference), so the typical <code>R</code> function never
acts directly on the global copy of the variable. Within a function, all
operations are generally performed on a local copy of the object, which
is then either discarded or returned back to the parent environment upon
when the function completes. This object-copying behaviour has given
<code>R</code> a reputation of being slow in comparison to languages
like <code>C</code> and <code>FORTRAN</code>. However, recent
improvements to <code>R</code> have made it more memory efficient and
faster to execute, in part by minimizing the number of object copies
made and lazy loading.</p>
<p>One way <code>SpaDES</code> reduces object copying is by storing and
modifying objects in a simulation environment, because environments in R
have <a href="http://adv-r.had.co.nz/Environments.html">reference
semantics</a>. Instead of storing simulation data in the global
environment, each <code>SpaDES</code> simulation uses a unique
environment wherein simulation data are referenced.</p>
</div>
<div id="module-object-dependencies" class="section level2"
number="3.3">
<h2><span class="header-section-number">3.3</span> Module object
dependencies</h2>
<p>As noted above, modules should not depend on one another for event
scheduling. However, it is often useful to develop collections of
modules that interact indirectly and are dependent on shared data
objects. Modules can be designed to rely on outputs (data objects) from
other modules. When objects are shared between modules, it is important
to state these dependencies explicitly. To check whether objects upon
which a model depends exist, a call to <code>checkObject</code> is made
during module initialization.</p>
<p>Note that modules need not be inter-dependent on one another: module
B may depend on module A (for example to initialize a data object),
without module A depending on module B.</p>
<p>To view the dependencies for a simulation:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## </span><span class="al">NOTE</span><span class="do">: Suggested packages SpaDES.tools and NLMR packages must be installed</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;SpaDES.taols&quot;)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;NLMR&quot;, repos = &quot;https://predictiveecology.r-universe.dev/&quot;)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES.core)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fl">0.0</span>, <span class="at">end =</span> <span class="fl">1.0</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>, <span class="at">burnStats =</span> <span class="st">&quot;nPixelsBurned&quot;</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;SpaDES_sampleModules&quot;</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> times, <span class="at">params =</span> parameters, <span class="at">modules =</span> modules, <span class="at">paths =</span> paths)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="do">## examine simulation module (object) dependencies</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">depsEdgeList</span>(mySim, <span class="cn">FALSE</span>)      <span class="co"># all object dependency relationships</span></span></code></pre></div>
<pre><code>##                from              to       objName   objClass
## 1:  caribouMovement caribouMovement       caribou SpatVector
## 2:       fireSpread caribouMovement     landscape SpatRaster
## 3:       fireSpread      fireSpread     landscape SpatRaster
## 4:       fireSpread      fireSpread nPixelsBurned    numeric
## 5: randomLandscapes caribouMovement     landscape SpatRaster
## 6: randomLandscapes      fireSpread     landscape SpatRaster</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clearPlot</span>()</span></code></pre></div>
<p><img
src="ii-modules_files/figure-html/module-object-diagrams-1.png" /><!-- --></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moduleDiagram</span>(mySim)            <span class="co"># simplified visual representation of modules</span></span></code></pre></div>
<p><img
src="ii-modules_files/figure-html/module-object-diagrams-2.png" /><!-- --></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clearPlot</span>()</span></code></pre></div>
<p><img
src="ii-modules_files/figure-html/module-object-diagrams-3.png" /><!-- --></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moduleDiagram</span>(mySim, <span class="at">showParents =</span> <span class="cn">TRUE</span>) <span class="co"># similar, but showing parent module grouping</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># detailed visual representation of objects</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">objectDiagram</span>(mySim, <span class="at">width =</span> <span class="dv">720</span>)</span></code></pre></div>
<div id="htmlwidget-ed1d8f173f79c5ec13fa" style="width:720px;height:288px;" class="DiagrammeR html-widget "></div>
<script type="application/json" data-for="htmlwidget-ed1d8f173f79c5ec13fa">{"x":{"diagram":"sequenceDiagram\ncaribouMovement ->> caribouMovement : caribou\nfireSpread ->> caribouMovement : landscape\nfireSpread ->> fireSpread : landscape\nfireSpread ->> fireSpread : nPixelsBurned\nrandomLandscapes ->> caribouMovement : landscape\nrandomLandscapes ->> fireSpread : landscape\n"},"evals":[],"jsHooks":[]}</script>
<p>The output of the <code>depsEdgeList</code> is an edgelist describing
the relationships between each module. In the example above, line 2 of
the output indicates that the <code>fireSpread</code> module relies on
an object <code>landscape</code> provided by the
<code>caribouMovement</code> module. This edgelist is used inside the
<code>depsGraph</code> function to produce a dependency graph (network),
where each module corresponds to a vertex (node), and object
dependencies are denoted by the arrows. When plotting the dependency
graph, it’s often useful to use the <code>plot=TRUE</code> argument to
simplify the network by showing no more than one object dependency
between modules.</p>
</div>
</div>
<div id="core-modules" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Core modules</h1>
<p>There are a number of built-in modules that provide useful
functionality such as plotting and saving. These modules have their
names prefaced with a dot (<code>.</code>). Parameter values for core
modules can be accessed by using their accessor methods; however, these
are simply entries in a nested list exactly like the parameters passed
to user modules, and can be accessed directly as such.</p>
<p>These core modules are summarized in the following table and
described further below.</p>
<table>
<colgroup>
<col width="22%" />
<col width="50%" />
<col width="26%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Module Name</strong></th>
<th><strong>Parameterization</strong></th>
<th><strong>Accessor Methods</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>.checkpoint</code></strong></td>
<td><code>file</code>: character.</td>
<td><code>checkpointFile()</code></td>
</tr>
<tr class="even">
<td> </td>
<td><code>interval</code>: numeric (or <code>NA</code>).</td>
<td><code>checkpointInterval()</code></td>
</tr>
<tr class="odd">
<td> </td>
<td> </td>
<td> </td>
</tr>
<tr class="even">
<td><strong><code>.plot</code></strong></td>
<td><code>.plotInitialTime</code>: numeric (or <code>NA</code>)</td>
<td>as list item in your module parameters.</td>
</tr>
<tr class="odd">
<td> </td>
<td><code>.plotInterval</code>: numeric (or <code>NA</code>)</td>
<td>as list item in your module parameters.</td>
</tr>
<tr class="even">
<td> </td>
<td> </td>
<td> </td>
</tr>
<tr class="odd">
<td><strong><code>.progress</code></strong></td>
<td><code>type</code>: one of <code>"text"</code>,
<code>"graphical"</code>,</td>
<td><code>progressType()</code></td>
</tr>
<tr class="even">
<td> </td>
<td><code>"shiny"</code>, or <code>NA</code>.</td>
<td> </td>
</tr>
<tr class="odd">
<td> </td>
<td><code>interval</code>: numeric (or <code>NA</code>).</td>
<td><code>progressInterval()</code></td>
</tr>
<tr class="even">
<td> </td>
<td> </td>
<td> </td>
</tr>
<tr class="odd">
<td><strong><code>.load</code></strong></td>
<td><code>inputs</code>: data.frame</td>
<td><code>inputs()</code> or passed as <code>inputs</code> argument to
<code>simList</code></td>
</tr>
<tr class="even">
<td> </td>
<td> </td>
<td> </td>
</tr>
<tr class="odd">
<td><strong><code>.save</code></strong></td>
<td><code>outputs</code>: data.frame</td>
<td><code>outputs()</code> or passed as <code>outputs</code> argument to
<code>simList</code></td>
</tr>
<tr class="even">
<td> </td>
<td><code>.saveInitialTime</code>: numeric (or <code>NA</code>)</td>
<td>as list item in your module parameters.</td>
</tr>
<tr class="odd">
<td> </td>
<td><code>.saveInterval</code>: numeric (or <code>NA</code>)</td>
<td>as list item in your module parameters.</td>
</tr>
<tr class="even">
<td> </td>
<td><code>.saveObjects</code>: character.</td>
<td>as list item in your module parameters.</td>
</tr>
<tr class="odd">
<td> </td>
<td><code>.savePath</code>: character.</td>
<td>as list item in your module parameters.</td>
</tr>
</tbody>
</table>
<div id="checkpoint-module" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span>
<code>.checkpoint</code> module</h2>
<p>Schedule automatic simulation checkpointing to allow you to resume a
previously saved simulation. All objects in the global environment
including the state of the random number generator are saved and can be
reloaded. Checkpoint frequency and filename can be passed as parameters
to the simulation object as illustrated below. By default, checkpointing
is not used unless the <code>interval</code> parameter is provided; the
simulation checkpoint file (if one exists) is loaded if the
<code>file</code> parameter is specified.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize a new simulation, setting the checkpoint interval and filename.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">5</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.checkpoint =</span> <span class="fu">list</span>(<span class="at">interval =</span> <span class="dv">2</span>, <span class="at">file =</span> <span class="st">&quot;chkpnt.RData&quot;</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;randomLandscapes&quot;</span>, <span class="st">&quot;caribouMovement&quot;</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>())</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> times, <span class="at">params =</span> parameters, <span class="at">modules =</span> modules, <span class="at">paths =</span> paths)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the checkpoint params from the simulation object</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="fu">checkpointFile</span>(mySim)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkpointInterval</span>(mySim)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
</div>
<div id="progress-module" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span>
<code>.progress</code> module</h2>
<p>Schedule updates to the simulation progress bar.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize a new simulation, setting the progress parameters</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fl">0.0</span>, <span class="at">end =</span> <span class="fl">10.0</span>),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">params =</span> <span class="fu">list</span>(<span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">.progress =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">&quot;text&quot;</span>, <span class="at">interval =</span> <span class="dv">1</span>)),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">modules =</span> <span class="fu">list</span>(<span class="st">&quot;randomLandscapes&quot;</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">paths =</span> <span class="fu">list</span>(<span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>())))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the checkpoint params from the simulation object</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">progressType</span>(mySim)</span></code></pre></div>
<pre><code>## [1] &quot;text&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">progressInterval</span>(mySim)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="load-and-.save-modules" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> <code>.load</code>
and <code>.save</code> modules</h2>
<p>Schedule object save and file load events by passing parameters to
the save and load parameters for each module. Saving objects to file can
be done at the module level or at the model level. At the module level,
each module can be provided with appropriate arguments as parameters. In
all cases, these must be events that are scheduled in the modules that
do the saving or loading, and then the parameters necessary to make
those events happen must be specified. Modules are not required to have
the following parameters set, but when using <code>newModule()</code> to
create the module, these will be events that are made, but not
scheduled:</p>
<table>
<colgroup>
<col width="30%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Argument</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>.saveInitialTime</code></strong></td>
<td>Numeric specifying the time at which the first save is scheduled
(between <code>start(sim)</code> and <code>end(sim)</code>).</td>
</tr>
<tr class="even">
<td><strong><code>.saveInterval</code></strong></td>
<td>Numeric specifying the interval at which objects will be saved.</td>
</tr>
<tr class="odd">
<td> </td>
<td>Used to schedule save events.</td>
</tr>
<tr class="even">
<td><strong><code>.saveObjects</code></strong></td>
<td>Character vector naming the objects to be saved.</td>
</tr>
</tbody>
</table>
<div id="inputs-argument-to-siminit" class="section level3"
number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> <code>inputs</code>
argument to <code>simInit</code></h3>
<p>Alternatively, objects can be read in during the <code>simInit</code>
function call by passing a data.frame to the <code>input</code>
argument. For <code>inputs()</code>, the <code>data.frame</code> must
consist of, minimally, a column named <code>file</code> listing the
absolute or relative filepaths of the files to be loaded. Additional
columns can also be provided:</p>
<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Column Name</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>file</code></strong></td>
<td>Character string indicating the absolute or relative file path to
individual file to load.</td>
</tr>
<tr class="even">
<td><strong><code>objectName</code></strong></td>
<td>Character string indicating the name of the object once the file is
loaded.</td>
</tr>
<tr class="odd">
<td><strong><code>fun</code></strong></td>
<td>Character string indicating the function to be used to load the
file. Can use <code>package::fun</code> notation.</td>
</tr>
<tr class="even">
<td><strong><code>package</code></strong></td>
<td>Character string indicating the package to load the <code>fun</code>
from. Not required if <code>fun</code> uses <code>package::fun</code>
notation</td>
</tr>
<tr class="odd">
<td><strong><code>intervals</code></strong></td>
<td>Numeric indicating the interval between repeated loading of the same
file.</td>
</tr>
<tr class="even">
<td> </td>
<td>This should be <code>NA</code> or the column absent if the file is
only loaded once.</td>
</tr>
<tr class="odd">
<td><strong><code>loadTime</code></strong></td>
<td>Numeric indicating when the file should be loaded. Defaults to
<code>simTime = 0</code>, but this</td>
</tr>
<tr class="even">
<td> </td>
<td>can be any time. The loading will be scheduled to occur at the
<code>loadTime</code>.</td>
</tr>
<tr class="odd">
<td> </td>
<td>If the same file is to be loaded many times, but not at a regular
interval, then there</td>
</tr>
<tr class="even">
<td> </td>
<td>should be separate line, with a unique <code>loadTime</code> for
each.</td>
</tr>
<tr class="odd">
<td><strong><code>args</code></strong></td>
<td>List of lists of named arguments; one list for each loading
function.</td>
</tr>
<tr class="even">
<td> </td>
<td>For example, if <code>raster</code> is a loading function,
<code>args = list(native = TRUE)</code>.</td>
</tr>
<tr class="odd">
<td> </td>
<td>If there is only one list, then it is assumed to apply to all load
attempts and will be</td>
</tr>
<tr class="even">
<td> </td>
<td>repeated for each load function.</td>
</tr>
</tbody>
</table>
</div>
<div id="outputs-argument-to-siminit" class="section level3"
number="4.3.2">
<h3><span class="header-section-number">4.3.2</span>
<code>outputs</code> argument to <code>simInit</code></h3>
<p>Objects to be saved can be specified using the <code>output</code>
argument, by passing a data.frame analogous to the <code>.load</code>
module. This <code>data.frame</code> is passed via the
<code>outputs</code> argument in the <code>simInit</code> call or via a
<code>outputs(mySim) &lt;- data.frame()</code>.</p>
<p>Saving files can be done “at the model level” by passing a simulation
parameter called <code>outputs</code> which can be a
<code>data.frame</code> and consists minimally of a column named
<code>objectName</code>. This will identify which objects should be
saved. Additional columns can also be provided:</p>
<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Column Name</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>objectName</code></strong></td>
<td>Character string indicating the name of the object once the file is
loaded.</td>
</tr>
<tr class="even">
<td><strong><code>file</code></strong></td>
<td>Character string indicating the base name to use to name the saved
file.</td>
</tr>
<tr class="odd">
<td><strong><code>fun</code></strong></td>
<td>Character string indicating the function to be used to save the
file.</td>
</tr>
<tr class="even">
<td><strong><code>package</code></strong></td>
<td>Character string indicating the package to find the previous
<code>fun</code> in.</td>
</tr>
<tr class="odd">
<td><strong><code>saveTime</code></strong></td>
<td>Numeric indicating when the file should be saved. Defaults to
<code>end(simList)</code>, but this can be any time. For multiple saves
of the same object, use unique lines, e.g., via
<code>data.table(expand.grid(objectName = c("caribou", "veg"), saveTime = 1:10))</code></td>
</tr>
</tbody>
</table>
<p>SpaDES will add a sixth column, <code>saved</code>, a logical, which
will become <code>TRUE</code> when (immediately following) the
successful save occurs.<br />
Therefore, a call to <code>outputs(mySim)</code> will indicate which
objects have been saved.</p>
<p>There is partial string matching of these names, so if the
<code>fun</code> requires arguments to be passed to it, use
<code>outputArgs()</code>, and it must be the same length as the
<code>outputs()</code> <code>data.frame</code>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize a new simulation, setting the load and save parameters</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>outputDir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;simOutputs&quot;</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">5</span>),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">params =</span> <span class="fu">list</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">randomLandscapes =</span> <span class="fu">list</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.saveInitialTime =</span> <span class="dv">0</span>, <span class="at">.saveInterval =</span> <span class="dv">2</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.saveObjects =</span> <span class="fu">c</span>(<span class="st">&quot;landscape&quot;</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.savePath =</span> <span class="fu">file.path</span>(outputDir, <span class="st">&quot;randomLandscapes&quot;</span>))</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                   ),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">modules =</span> <span class="fu">list</span>(<span class="st">&quot;randomLandscapes&quot;</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">paths =</span> <span class="fu">list</span>(<span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()),</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">outputPath =</span> outputDir),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">outputs =</span> <span class="fu">data.frame</span>(<span class="at">objectName =</span> <span class="st">&quot;landscape&quot;</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the load and save params from the simulation object</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="fu">inputs</span>(mySim)    <span class="co"># shows all files and objects that are &quot;inputs&quot;</span></span></code></pre></div>
<pre><code>## [1] file       fun        package    objectName loadTime   loaded     arguments 
## [8] intervals 
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">outputs</span>(mySim)   <span class="co"># shows all files and objects that are &quot;outputs&quot;</span></span></code></pre></div>
<pre><code>##   objectName                                           file     fun package
## 1  landscape /tmp/RtmpG9NhfZ/simOutputs/landscape_year5.rds saveRDS    base
##   saveTime saved arguments
## 1        5    NA        NA</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.saveInitialTime</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.saveInterval</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.saveObjects</span></code></pre></div>
<pre><code>## [1] &quot;landscape&quot;</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.savePath</span></code></pre></div>
<pre><code>## [1] &quot;/tmp/RtmpG9NhfZ/simOutputs/randomLandscapes&quot;</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ftmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">pattern =</span> <span class="st">&quot;spades_vignetteOutputs&quot;</span>, <span class="at">fileext =</span> <span class="st">&quot;.pdf&quot;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(ftmp)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">clearPlot</span>()</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>mySim2 <span class="ot">&lt;-</span> <span class="fu">spades</span>(mySim)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># More sophisticated, passing arguments to outputs()</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">outputs</span>(mySim) <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">objectName =</span> <span class="st">&quot;landscape&quot;</span>, <span class="at">fun =</span> <span class="st">&quot;writeRaster&quot;</span>, <span class="at">package =</span> <span class="st">&quot;terra&quot;</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">saveTime =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>), <span class="at">arguments =</span> <span class="fu">I</span>(<span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>), <span class="cf">function</span>(x) {</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">datatype =</span> <span class="st">&quot;FLT4S&quot;</span>, <span class="at">filetype =</span> <span class="st">&quot;GTiff&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>})))</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>mySim2 <span class="ot">&lt;-</span> <span class="fu">spades</span>(mySim)</span></code></pre></div>
<pre><code>## Warning in x@ptr$writeRaster(opt): GDAL Error 6:
## /tmp/RtmpG9NhfZ/simOutputs/landscape_year3.tif, band 1: SetColorTable() not
## supported for multi-sample TIFF files.</code></pre>
<pre><code>## Warning: [writeRaster] change datatype to INT1U to write the color-table
## could not write the color table</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="fu">normalizePath</span>(ftmp))</span></code></pre></div>
<p>Saving within a module – scheduling save events.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="do">### WITHIN A MODULE:</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># schedule a recurring save event</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>nextSave <span class="ot">&lt;-</span> <span class="fu">time</span>(mySim) <span class="sc">+</span> <span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.saveInterval</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(mySim, nextSave, <span class="st">&quot;randomLandscapes&quot;</span>, <span class="st">&quot;save&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="plotting" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Plotting</h2>
<p>Plotting events can be scheduled similarly to save events, by passing
module-specific parameters indicating when to schedule the first plot
event and how often to rescheduling recurring plot events. By default,
when a module is created with a <code>newModule()</code> call, plotting
will be scheduled using <code>.plotInitialTime</code>. The default is
NA, i.e., no plotting.</p>
<ul>
<li><code>.plotInitialTime</code>: The time at which the first plot is
scheduled.</li>
<li><code>.plotInterval</code>: The interval at which objects will be
plotted. Used to schedule plot events.</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize a new simulation, setting the load and save parameters</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> <span class="dv">5</span>),</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">params =</span> <span class="fu">list</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>),</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">randomLandscapes =</span> <span class="fu">list</span>(<span class="at">.plotInitialTime =</span> <span class="dv">0</span>, <span class="at">.plotInterval =</span> <span class="dv">1</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">modules =</span> <span class="fu">list</span>(<span class="st">&quot;randomLandscapes&quot;</span>),</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">paths =</span> <span class="fu">list</span>(<span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()))</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the plotting params from the simulation object</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.plotInitialTime</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.plotInterval</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="do">### WITHIN A MODULE:</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># schedule a recurring plot event</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>nextPlot <span class="ot">&lt;-</span> <span class="fu">time</span>(mySim) <span class="sc">+</span> <span class="fu">params</span>(mySim)<span class="sc">$</span>randomLandscapes<span class="sc">$</span>.plotInterval</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(mySim, nextPlot, <span class="st">&quot;randomLandscapes&quot;</span>, <span class="st">&quot;save&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="using-existing-spades-modules" class="section level1"
number="5">
<h1><span class="header-section-number">5</span> Using existing
<code>SpaDES</code> modules</h1>
<p>One of the primary motivations of developing the <code>SpaDES</code>
package is to facilitate module reuse. We provide a few modules with
this package as samples for demos and the vignettes, which can be used
as a starting point for your own module development. We also maintain a
publicly accessible repository of <code>SpaDES</code> modules (details
below).</p>
<p>Before using other modules, it is up to the modeler (you!) to
understand the technical and scientific limitations of these modules.
Although <code>SpaDES</code> provides some built-in functionality to
ensure different modules will work together, and warn the user if
certain module combinations are invalid, when deciding upon which
modules to use, be sure to also:</p>
<ol style="list-style-type: decimal">
<li>Ensure you are using a suitable <code>R</code> version;</li>
<li>Check package dependencies and ensure you have the necessary
packages installed on your system;</li>
<li>Check module object dependencies (<code>simInit</code> does
this);</li>
<li>Check module compatibility (<em>e.g.</em>, spatial extent,
timeframe, etc.) (<code>simInit</code> only does a basic version of
this).</li>
</ol>
<p>See the <code>SpaDES</code> wiki (<a
href="https://github.com/PredictiveEcology/SpaDES/wiki">https://github.com/PredictiveEcology/SpaDES/wiki</a>)
for more detailed information on getting started.</p>
<div id="included-sample-modules" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Included sample
modules</h2>
<p>Use <code>getSampleModules(tempdir())</code> to get the path to a
copy of the <code>sampleModules</code> directory. To view the contents
of a module, use the <code>openModules</code> function. Note that you
should not edit the sample modules directly, but save them as a copy in
another location.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">openModules</span>(<span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()), <span class="st">&quot;moduleName&quot;</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><code>randomLandscapes</code>: Generate <code>RasterStack</code>
of random maps representative of a forest landscape (<code>DEM</code>,
<code>forestAge</code>, <code>habitatQuality</code>,
<code>percentPine</code>). Requires a global simulation parameter
<code>stackName</code> be set.</p></li>
<li><p><code>fireSpread</code>: Simulate fire ignition and spread on a
landscape, where spread probability varies according to percent pine.
Fire size statistics are collected immediately after each burn event.
Requires a global simulation parameter <code>stackName</code> be
set.</p></li>
<li><p><code>caribouMovement</code>: Agent based model of caribou
movement via correlated random walk. Requires a <code>RasterStack</code>
object whose name is specified by <code>globals(sim)$stackName</code>,
containing a <code>RasterLayer</code> named
<code>habitatQuality</code>.</p></li>
</ol>
</div>
<div id="spades-module-repository" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> <code>SpaDES</code>
module repository</h2>
<p><strong>Website:</strong> <a
href="https://github.com/PredictiveEcology/SpaDES-modules">https://github.com/PredictiveEcology/SpaDES-modules</a></p>
<p>Modules from this (or another suitable GitHub repository) can be
downloaded using:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadModule</span>(<span class="st">&quot;moduleName&quot;</span>)</span></code></pre></div>
<p><strong>Note:</strong> by default, modules and their data are saved
to the directory specified by the <code>spades.modulesPath</code>. An
alternate path can be provided to <code>downloadModule</code> directly
via the <code>path</code> argument, or specified using
<code>options(spades.modulesPath = "path/to/my/modules")</code>.</p>
</div>
</div>
<div id="creating-new-modules" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Creating new
modules</h1>
<div id="module-design-considerations" class="section level2"
number="6.1">
<h2><span class="header-section-number">6.1</span> Module design
considerations</h2>
<p>As noted above, modules should function as independently as possible
so that they retain their modularity. While it may be useful for modules
to exhibit indirect dependence on each other via shared data objects
(such as maps), modules should not depend directly on each other via
event scheduling.</p>
</div>
<div id="using-the-module-template" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Using the module
template</h2>
<p>Code for new modules can be developed quickly using the template
generator function <code>newModule</code>(also available as an RStudio
add-in) which accepts as arguments the name of the new module, a
directory path in which to create the new module, and a logical
indicating whether to open the newly created module code file for
editing.</p>
<p>Module developers can set the <code>devtools.desc.author</code>
option (<em>e.g.</em>, in their <code>.Rprofile</code> to automatically
supply a default module author). See <code>package?devtools</code> for
more details.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new module called &quot;randomLandscape&quot; in the &quot;custom-modules&quot; subdirectory</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and open the resulting file immediately for editing.</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">newModule</span>(<span class="at">name =</span> <span class="st">&quot;randomLandscapes&quot;</span>, <span class="at">path =</span> <span class="st">&quot;custom-modules&quot;</span>, <span class="at">open =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The newly created file can now be modified in the identified sections
and customized to your module. However, it is very important that you do
not edit portions of the file outside of the designated sections or your
module may fail to work properly within a simulation.</p>
</div>
<div id="module-groups" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Module groups</h2>
<p>A ‘module group’ is simply a convenient way of specifying multiple
modules. Module groups are specified by naming child modules in the
<code>defineModule</code> block of the metadata. For example, the
<code>SpaDES_sampleModules</code> module group lists the following
modules as “children”:</p>
<ul>
<li><code>caribouMovement</code></li>
<li><code>fireSpread</code></li>
<li><code>randomLandscapes</code></li>
</ul>
<p>Module groups make loading multiple modules easier: only the name of
the module group needs to be specified in the <code>simInit</code> call,
which will then initialize the simulation with the child modules.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES.core)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>outputDir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;simOutputs&quot;</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fl">0.0</span>, <span class="at">end =</span> <span class="fl">20.0</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">.globals =</span> <span class="fu">list</span>(<span class="at">stackName =</span> <span class="st">&quot;landscape&quot;</span>, <span class="at">burnStats =</span> <span class="st">&quot;nPixelsBurned&quot;</span>),</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">.progress =</span> <span class="fu">list</span>(<span class="cn">NA</span>),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomLandscapes =</span> <span class="fu">list</span>(<span class="at">nx =</span> 100L, <span class="at">ny =</span> 100L, <span class="at">inRAM =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fireSpread =</span> <span class="fu">list</span>(</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">nFires =</span> 10L, <span class="at">spreadprob =</span> <span class="fl">0.225</span>, <span class="at">its =</span> <span class="fl">1e6</span>, <span class="at">persistprob =</span> <span class="dv">0</span>,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">returnInterval =</span> <span class="dv">10</span>, <span class="at">startTime =</span> <span class="dv">0</span>,</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.plotInitialTime =</span> <span class="dv">0</span>, <span class="at">.plotInterval =</span> <span class="dv">10</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">caribouMovement =</span> <span class="fu">list</span>(</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> 100L, <span class="at">moveInterval =</span> <span class="dv">1</span>, <span class="at">torus =</span> <span class="cn">TRUE</span>,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.plotInitialTime =</span> <span class="dv">1</span>, <span class="at">.plotInterval =</span> <span class="dv">1</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>modules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;SpaDES_sampleModules&quot;</span>)</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>objects <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">modulePath =</span> <span class="fu">getSampleModules</span>(<span class="fu">tempdir</span>()),</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputPath =</span> outputDir</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> times, <span class="at">params =</span> parameters, <span class="at">modules =</span> modules,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">objects =</span> objects, <span class="at">paths =</span> paths)</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a><span class="fu">modules</span>(mySim) <span class="co"># note the child modules are initialized</span></span></code></pre></div>
<p>Module groups can also be used to simplify the download of multiple
modules:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">downloadModule</span>(<span class="st">&quot;SpaDES_sampleModules&quot;</span>)</span></code></pre></div>
</div>
<div id="debugging" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Debugging</h2>
<p>Various debugging techniques are discussed at <a
href="https://github.com/PredictiveEcology/SpaDES/wiki/Debugging">https://github.com/PredictiveEcology/SpaDES/wiki/Debugging</a>.</p>
</div>
<div id="contributing-modules" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Contributing
modules</h2>
<p>After publication you may wish to make your module more easily
accessible for others to use (in fact we encourage it). We maintain a
repository of <code>SpaDES</code> modules at the following site: <a
href="https://github.com/PredictiveEcology/SpaDES-modules">https://github.com/PredictiveEcology/SpaDES-modules</a></p>
<div id="minimum-requirements" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Minimum
requirements</h3>
<p>All contributed modules should be well documented. In addition to
providing <em>complete</em> metadata within the module’s <code>.R</code>
file, the following components (see details above) should be
included:</p>
<ol style="list-style-type: decimal">
<li>Complete module documentation, such as an R Markdown
(<code>.Rmd</code>) document that can be built as a
<code>PDF</code>.</li>
<li>A <code>citation.bib</code> file containing a BibTeX-formatted
citation for your module (or for the publication describing your
module). This citation will be used by others when citing your
module.</li>
<li>A <code>LICENSE</code> file describing how your module code may be
used and modified.</li>
<li>A <code>README</code> file containing an overview of your module and
updates that are included with each version.</li>
</ol>
<p>Note that <code>newModule()</code> produces skeleton templates of
these files. Additionally, <code>zipModule()</code> can be used to build
the <code>.zip</code> file corresponding to a particular version of your
module.</p>
</div>
<div id="module-submission" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Module
submission</h3>
<p>To submit your module for inclusion in our GitHub repository, login
to GitHub with your account and initiate a pull request to the
repository. See the <a
href="https://docs.github.com/articles/creating-a-pull-request/">GitHub
help documentation</a> for more details.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
